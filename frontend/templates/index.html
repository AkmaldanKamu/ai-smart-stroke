<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SiTANGGAP - Sistem Tangkap Gejala Stroke Cepat</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../static/style.css" />
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-brain"></i> SiTANGGAP</h1>
            <p class="subtitle">
                Sistem Tangkap Gejala Stroke Cepat - Untuk mendeteksi gejala awal stroke dan menilai tingkat keparahannya.
            </p>
        </div>

        <!-- Hero Section -->
        <div class="hero-section">
            <div class="hero-content">
                <div class="hero-text">
                    <h2><i class="fas fa-robot"></i> AI Deteksi Stroke Terdepan</h2>
                    <p>
                        SiTANGGAP menggunakan teknologi Artificial Intelligence (AI) canggih untuk mendeteksi gejala awal stroke melalui analisis ekspresi wajah dan pola bicara.
                    </p>
                    <p>
                        Dirancang agar inklusif dan mudah diakses, SiTANGGAP memungkinkan siapa pun dan di mana pun mereka berada, untuk melakukan deteksi awal stroke hanya dengan perangkat kamera dan mikrofon.
                    </p>
                    <p>
                        <strong>Deteksi awal stroke dapat menyelamatkan nyawa!</strong> Setiap menit sangat berharga dalam penanganan stroke.
                    </p>
                </div>
                <div class="hero-visual">
                    <div class="stats-section">
                        <div class="stats-section-center">
                            <div class="stat-card">
                                <div class="stat-number">&lt;60s</div>
                                <div class="stat-label">Waktu Analisis</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">2</div>
                                <div class="stat-label">Metode Deteksi</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">NIHSS</div>
                                <div class="stat-label">Standar Skoring Medis</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <section class="accordion-section">
            <div class="container two-column-accordion">
                <!-- Kolom Kiri: Kenapa Penting -->
                <div class="accordion-column">
                    <h2 class="accordion-title">
                        Kenapa <span>SiTANGGAP Penting?</span>
                    </h2>

                    <div class="accordion-item">
                        <div class="accordion-header">
                            <i class="fas fa-brain"></i>
                            <h3>Stroke = Darurat Medis</h3>
                            <span class="arrow">&#9662;</span>
                        </div>
                        <div class="accordion-content" style="text-align: justify">
                            <p>
                                Menurut data WHO, Indonesia memiliki beban stroke yang signifikan secara global. Pada tahun 2020, Indonesia menduduki peringkat ke-11 di dunia untuk angka kematian stroke yang disesuaikan usia. Bahkan Indonesia menempati peringkat ke-7 tertinggi dalam
                                kematian akibat stroke berdasarkan data WHO tahun 2018. Secara umum, stroke merupakan penyebab utama kematian di Indonesia.
                            </p>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header">
                            <i class="fas fa-stopwatch"></i>
                            <h3>Golden Hour 3 Jam</h3>
                            <span class="arrow">&#9662;</span>
                        </div>
                        <div class="accordion-content">
                            <p>
                                Waktu krusial hanya 3 jam pertama setelah serangan stroke. Deteksi awal bisa menyelamatkan dari serangan gejala stroke.
                            </p>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header">
                            <i class="fas fa-house-medical"></i>
                            <h3>
                                <center>Banyak Terjadi di Rumah</center>
                            </h3>
                            <span class="arrow">&#9662;</span>
                        </div>
                        <div class="accordion-content">
                            <p>
                                Kebanyakan stroke terjadi tanpa disadari di rumah, dan sering terlambat ditangani.
                            </p>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header">
                            <i class="fas fa-map-marked-alt"></i>
                            <h3>
                                <center>Solusi untuk Wilayah Terpencil</center>
                            </h3>
                            <span class="arrow">&#9662;</span>
                        </div>
                        <div class="accordion-content">
                            <p>
                                SiTANGGAP bisa digunakan di daerah yang jauh dari rumah sakit ‚Äî cukup dengan kamera dan mikrofon.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Kolom Kanan: Kenapa Efektif -->
                <div class="accordion-column">
                    <h2 class="accordion-title">
                        Kenapa <span>SiTANGGAP Efektif?</span>
                    </h2>

                    <div class="accordion-item">
                        <div class="accordion-header">
                            <i class="fas fa-bolt"></i>
                            <h3>Deteksi Cepat</h3>
                            <span class="arrow">&#9662;</span>
                        </div>
                        <div class="accordion-content">
                            <p>
                                Hasil analisis wajah dan suara keluar dalam kurang dari 60 detik.
                            </p>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header">
                            <i class="fas fa-mobile-alt"></i>
                            <h3>
                                <center>Praktis dan Mudah Digunakan</center>
                            </h3>
                            <span class="arrow">&#9662;</span>
                        </div>
                        <div class="accordion-content">
                            <p>
                                Tanpa alat medis untuk deteksi awal ‚Äî hanya butuh HP atau laptop. Bisa dilakukan siapa saja.
                            </p>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header">
                            <i class="fas fa-laptop-medical"></i>
                            <h3>Berbasis Data Medis</h3>
                            <span class="arrow">&#9662;</span>
                        </div>
                        <div class="accordion-content">
                            <p>
                                Skoring didasarkan pada National Institute of Health Stroke Score (NIHSS), skala yang diakui secara internasional dalam evaluasi gejala stroke.
                            </p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <div class="accordion-header">
                            <i class="fas fa-user-shield"></i>
                            <h3>Privasi Terjamin</h3>
                            <span class="arrow">&#9662;</span>
                        </div>
                        <div class="accordion-content">
                            <p>
                                Data diproses secara lokal, tidak disimpan di server. Aman dan sesuai etika medis.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- AI Features -->
        <div class="ai-features">
            <div class="feature-card" onclick="showPopup('wajah')">
                <i class="fas fa-face-smile"></i>
                <h3>Analisis Ekspresi Wajah</h3>
                <p>
                    AI menganalisis asimetri wajah, ptosis mata, dan kemiringan senyuman untuk mendeteksi gejala stroke facial palsy. <br /><em>Klik untuk lihat rincian skor.</em
            >
          </p>
        </div>
        <div class="feature-card" onclick="showPopup('suara')">
          <i class="fas fa-microphone-alt"></i>
          <h3>Analisis Pola Bicara</h3>
          <p>
            Sistem mengevaluasi kejelasan artikulasi, kecepatan bicara, dan pola
            intonasi untuk mendeteksi disartria. <br /><em
              >Klik untuk lihat rincian skor.</em
            >
          </p>
        </div>
        <div class="feature-card" onclick="showPopup('nihss')">
          <i class="fas fa-chart-line"></i>
          <h3>Scoring NIHSS</h3>
          <p>
            Menggunakan skala NIHSS (National Institutes of Health Stroke Scale)
            untuk penilaian tingkat keparahan stroke. <br /><em
              >Klik untuk lihat bagaimana skor ditentukan.</em
            >
          </p>
        </div>
      </div>

      <!-- Technology Section -->
      <div class="tech-section">
        <h3><i class="fas fa-cogs"></i> Teknologi yang Digunakan</h3>
        <div class="tech-grid">
          <div class="tech-item">
            <i class="fas fa-brain"></i>
            <h4>Deep Learning</h4>
            <p>Neural networks untuk analisis wajah</p>
          </div>
          <div class="tech-item">
            <i class="fas fa-wave-square"></i>
            <h4>Signal Processing</h4>
            <p>Analisis sinyal suara digital</p>
          </div>
          <div class="tech-item">
            <i class="fas fa-eye"></i>
            <h4>Computer Vision</h4>
            <p>Deteksi landmarks wajah</p>
          </div>
          <div class="tech-item">
            <i class="fas fa-microphone"></i>
            <h4>Speech Recognition</h4>
            <p>Konversi suara ke teks</p>
          </div>
        </div>
      </div>

      <!-- Disclaimer -->
      <div class="disclaimer-section">
        <h3><i class="fas fa-exclamation-triangle"></i> Disclaimer Penting</h3>

        <p>
          <strong>PERHATIAN:</strong> SiTANGGAP adalah sistem bantuan deteksi
          dini stroke yang menggunakan teknologi Artificial Intelligence (AI).
          Aplikasi ini <strong>BUKAN</strong> alat diagnostik medis dan
          <strong>TIDAK DAPAT</strong> menggantikan pemeriksaan, diagnosis, atau
          penanganan oleh tenaga medis profesional.
        </p>

        <p><strong>Hal-hal yang perlu dipahami:</strong></p>
        <ul style="margin-left: 20px; margin-top: 10px">
          <li>
            <strong>Hasil Skrining:</strong> Sistem ini hanya memberikan
            indikasi awal kemungkinan gejala stroke, bukan diagnosis medis yang
            definitif
          </li>
          <li>
            <strong>Akurasi Terbatas:</strong> Teknologi AI dapat mengalami
            kesalahan interpretasi dan tidak 100% akurat
          </li>
          <li>
            <strong>Konsultasi Medis Wajib:</strong> Segera hubungi dokter,
            rumah sakit, atau fasilitas kesehatan terdekat jika mendapat hasil
            yang mengkhawatirkan
          </li>
          <li>
            <strong>Jangan Menunda:</strong> Dalam kondisi stroke, waktu adalah
            faktor krusial - jangan mengandalkan aplikasi ini sebagai
            satu-satunya rujukan
          </li>
        </ul>

        <p style="margin-top: 15px">
          <strong>üö® KONDISI DARURAT:</strong> Jika mengalami gejala stroke
          mendadak (wajah tidak simetris, lemah sebelah badan, bicara pelo,
          sakit kepala hebat), segera hubungi <strong>119</strong> atau bawa ke
          IGD rumah sakit terdekat tanpa menunggu hasil aplikasi ini.
        </p>

        <p style="margin-top: 15px">
          <strong>üîí Keamanan & Privasi Data:</strong> Semua data video, audio,
          dan informasi personal diproses secara lokal di perangkat Anda dan
          <strong>tidak disimpan, dikirim, atau dibagikan</strong> ke server
          manapun. Data Anda sepenuhnya aman dan privat.
        </p>
      </div>

      <!-- CTA Section -->
      <div class="cta-section">
        <h3><i class="fas fa-rocket"></i> Mulai Deteksi Sekarang</h3>
        <p>
          Lakukan tes deteksi stroke dengan AI dalam hitungan menit. Pastikan
          Anda berada di ruangan dengan pencahayaan yang baik.
        </p>
        <button
          class="start-test-btn"
          onclick="document.getElementById('video').scrollIntoView({behavior: 'smooth'})"
        >
          <i class="fas fa-play-circle"></i> Mulai Tes Deteksi
        </button>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <div class="camera-section">
          <h2><i class="fas fa-camera"></i> Kamera Deteksi</h2>
          <video id="video" width="400" height="300" autoplay muted></video>
        </div>

        <div class="controls-section">
          <h2><i class="fas fa-cogs"></i> Kontrol Tes</h2>
          <div class="button-group">
            <button class="btn btn-primary" onclick="deteksiWajah()">
              <i class="fas fa-smile"></i> Tes Ekspresi Wajah
            </button>
            <button
              id="btn-voice"
              class="btn btn-secondary"
              onclick="mulaiTesSuara()"
            >
              <i class="fas fa-microphone"></i> Tes Ucapan
            </button>
            <button
              id="btn-diagnosa"
              class="btn btn-success"
              onclick="diagnosaStroke()"
              disabled
            >
              <i class="fas fa-search"></i> Cek Diagnosa Stroke
            </button>
          </div>
        </div>
      </div>

      <!-- Results Section -->
      <div class="results-section">
        <h2><i class="fas fa-chart-line"></i> Hasil Deteksi</h2>

        <div class="result-item">
          <p id="hasil-wajah">Belum ada hasil deteksi wajah</p>
          <ul id="detail-wajah"></ul>
        </div>

        <div class="result-item">
          <p id="status-audio">Belum ada hasil deteksi suara</p>
          <p id="transkrip-audio"></p>
          <p id="skor-audio"></p>
        </div>
      </div>

      <!-- Diagnosis Section -->
      <div class="diagnosis-section">
        <h2><i class="fas fa-stethoscope"></i> Diagnosa Stroke</h2>

        <div class="diagnosis-result">
          <p id="diagnosa-hasil">
            Silakan lakukan tes wajah dan suara terlebih dahulu
          </p>
          <p id="diagnosa-penanganan"></p>
        </div>

        <div class="diagnosis-summary">
          <ul id="diagnosa-summary"></ul>
        </div>

        <!-- Panduan & Edukasi -->
        <div class="guidance-section">
          <h2><i class="fas fa-hands-helping"></i> Panduan & Edukasi</h2>
          <div class="guidance-inner" id="guidance-text">
            <div class="guidance-box guidance-placeholder">
              <i class="fas fa-lightbulb"></i> Panduan akan muncul setelah hasil
              diagnosa.
            </div>
          </div>
        </div>
      </div>
      <!-- penutup diagnosis-section -->
    </div>
    <!-- penutup .container -->

<!-- Footer dipindah ke luar container -->
<div class="footer">
    <p>
      &copy; 2025 SiTANGGAP - Sistem Deteksi Stroke awal | Kesehatan adalah
      prioritas utama
    </p>
    <p style="margin-top: 10px; font-size: 0.8rem; opacity: 0.8">
      Dikembangkan dengan teknologi AI untuk membantu deteksi awal stroke.
      Selalu konsultasikan dengan tenaga medis profesional.
    </p>
  
    <!-- Footer Sources -->
    <div class="footer">
        <div class="footer-sources">
        <p class="footer-title">Sumber Referensi:</p>
        <ul>
            <li><a href="https://data.who.int/countries/360" target="_blank">World Health Organization - Data Stroke Indonesia</a></li>
            <li><a href="https://www.cdc.gov/stroke/signs-symptoms/index.html" target="_blank">Centers for Disease Control and Prevention</a></li>
            <li><a href="https://kemkes.go.id/id/cegah-stroke-dengan-aktivitas-fisik" target="_blank">Kemenkes RI - Cegah Stroke dengan Aktivitas Fisik</a></li>
            <li><a href="https://ayosehat.kemkes.go.id/kenali-gejala-stroke-dengan-segera-ke-rs" target="_blank">Kemenkes RI - Kenali Gejala Stroke dengan Segera ke RS</a></li>
            <li><a href="https://setjen.kemkes.go.id/medkom/detail/waspadai-stroke" target="_blank">Setjen Kemenkes RI - Waspadai Stroke</a></li>
            <li><a href="https://www.worldlifeexpectancy.com/cause-of-death/stroke/by-country/" target="_blank">World Life Expectancy</a></li>
        </ul>
        </div>
    </div>
  </div>
  

    <script defer>
      const video = document.getElementById("video");
      const hasilDeteksi = {
        wajah: null,
        suara: null,
        face_score: null,
        suara_score: null,
      };

      function startSmartCamera() {
        navigator.mediaDevices.enumerateDevices().then((devices) => {
          const cams = devices.filter((d) => d.kind === "videoinput");
          const selected =
            cams.find((d) => !d.label.toLowerCase().includes("iriun")) ||
            cams[0];

          if (!selected) {
            alert("‚ùå Tidak ada kamera terdeteksi.");
            return;
          }

          navigator.mediaDevices
            .getUserMedia({
              video: {
                deviceId: {
                  ideal: selected.deviceId,
                },
              },
            })
            .then((stream) => {
              video.srcObject = stream;
            })
            .catch((err) => {
              alert("‚ùå Gagal akses kamera: " + err.name);
            });
        });
      }

      startSmartCamera();

      function ambilFrameBase64() {
        const canvas = document.createElement("canvas");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext("2d").drawImage(video, 0, 0);
        return canvas.toDataURL("image/jpeg");
      }

      function updateDiagnosaButton() {
        const btn = document.getElementById("btn-diagnosa");
        btn.disabled = !(hasilDeteksi.wajah && hasilDeteksi.suara);
      }

      // =====================
      // üö® DETEKSI WAJAH
      // =====================
      function deteksiWajah() {
        Swal.fire({
          title: "üì∏ Siap untuk Deteksi Wajah",
          text: "Senyum ke kamera, wajah di tengah, jangan miring.",
          icon: "info",
          confirmButtonText: "Mulai",
        }).then(() => lanjutDeteksiWajah());
      }

      function lanjutDeteksiWajah() {
        const el = document.getElementById("hasil-wajah");
        const detail = document.getElementById("detail-wajah");
        el.innerHTML =
          '<i class="fas fa-spinner fa-spin"></i> Mendeteksi ekspresi wajah...';
        detail.innerHTML = "";

        const imageBase64 = ambilFrameBase64();

        fetch("/detect-face", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            image: imageBase64,
          }),
        })
          .then((res) => res.json())
          .then((data) => {
            if (data.status !== "ok") {
              el.innerHTML = `‚ùå Gagal deteksi wajah: ${data.message}`;
              return;
            }

            hasilDeteksi.wajah = data.kategori;
            hasilDeteksi.face_score = data.score_total;

            el.innerHTML = `‚úÖ Wajah: ${data.kategori}`;
            const p = data.penilaian;
            detail.innerHTML = `
                        <li><strong>"üë§" Total Skor Wajah:</strong> ${
                          data.score_total
                        }/6</li>
                        <li><strong>üí° Saran:</strong> ${data.saran}</li>
                        <hr>
                        <li><strong>üëÑ Bibir</strong></li>
                        <ul><li>Delta Y: ${p.bibir.delta_y}</li><li>Rasio X: ${
              p.bibir.rasio_x
            }</li><li>Skor: ${p.bibir.nilai}/2</li></ul>
                        <li><strong>üëÅÔ∏è Mata</strong></li>
                        <ul><li>Delta Openness: ${
                          p.mata.delta_openness
                        }</li><li>Ptosis: ${
              p.mata.ptosis_suspect ? "Ya" : "Tidak"
            }</li><li>Skor: ${p.mata.nilai}/2</li></ul>
                        <li><strong>üßè‚Äç‚ôÄÔ∏è Pipi</strong></li>
                        <ul><li>Kemiringan: ${
                          p.pipi.kemiringan_derajat
                        }¬∞</li><li>Skor: ${p.pipi.nilai}/2</li></ul>
                    `;
            updateDiagnosaButton();
          })
          .catch(() => (el.innerHTML = "‚ùå Gagal deteksi wajah"));
      }

      // =====================
      // üé§ DETEKSI SUARA
      // =====================
      function mulaiTesSuara() {
        Swal.fire({
          title: "üé§ Siap Tes Ucapan",
          html: 'Ucapkan dengan jelas: <br><b>"Hari ini saya makan nasi"</b>',
          icon: "info",
          showCancelButton: true,
          confirmButtonText: "Mulai Rekam",
        }).then((result) => {
          if (result.isConfirmed) {
            rekamSuaraDanKirim();
          }
        });
      }

      function rekamSuaraDanKirim() {
        const status = document.getElementById("status-audio");
        const transkrip = document.getElementById("transkrip-audio");
        const skor = document.getElementById("skor-audio");
        const btn = document.getElementById("btn-voice");

        btn.disabled = true;
        status.innerText = "‚è∫Ô∏è Merekam suara selama 5 detik...";
        transkrip.innerText = "";
        skor.innerText = "";

        navigator.mediaDevices
          .getUserMedia({
            audio: true,
          })
          .then((stream) => {
            const mediaRecorder = new MediaRecorder(stream);
            const chunks = [];

            mediaRecorder.ondataavailable = (e) => {
              if (e.data.size > 0) chunks.push(e.data);
            };

            mediaRecorder.onstop = () => {
              const audioBlob = new Blob(chunks, {
                type: "audio/webm",
              });
              const formData = new FormData();
              formData.append("audio", audioBlob);

              status.innerText = "üß† Menganalisis suara...";

              fetch("/analyze-audio", {
                method: "POST",
                body: formData,
              })
                .then((res) => res.json())
                .then((data) => {
                  hasilDeteksi.suara = data.hasil;
                  hasilDeteksi.suara_score = data.score;

                  status.innerText = `‚úÖ Hasil Suara: ${data.hasil}`;
                  transkrip.innerText = `üó£Ô∏è Transkrip: ${data.transkrip}`;
                  skor.innerText = `üéØ Skor Suara: ${data.score}/2`;

                  btn.disabled = false;
                  updateDiagnosaButton();
                })
                .catch(() => {
                  status.innerText = "‚ùå Gagal menganalisis suara.";
                  btn.disabled = false;
                });
            };

            mediaRecorder.start();
            setTimeout(() => {
              mediaRecorder.stop();
              stream.getTracks().forEach((t) => t.stop());
            }, 5000);
          })
          .catch((err) => {
            Swal.fire("‚ùå Gagal akses mikrofon", err.message, "error");
            btn.disabled = false;
          });
      }

      // =====================
      // üîç DIAGNOSA FINAL
      // =====================
      function diagnosaStroke() {
        const output = document.getElementById("diagnosa-hasil");
        const summary = document.getElementById("diagnosa-summary");
        const penanganan = document.getElementById("diagnosa-penanganan");
        const guidanceBox = document.getElementById("guidance-text");

        output.innerText = "‚è≥ Menganalisis semua indikator...";
        summary.innerHTML = "";
        penanganan.innerText = "";
        guidanceBox.innerHTML = "‚è≥ Menyusun panduan pertolongan pertama...";

        fetch("/diagnosa", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            image: ambilFrameBase64(),
            face_score: hasilDeteksi.face_score,
            face_kategori: hasilDeteksi.wajah,
            voice_result: hasilDeteksi.suara,
            voice_score: hasilDeteksi.suara_score,
          }),
        })
          .then((res) => res.json())
          .then((data) => {
            if (data.status !== "ok") {
              output.innerText = `‚ùå Gagal diagnosa: ${data.message}`;
              guidanceBox.innerHTML = "‚ùå Gagal memuat panduan.";
              return;
            }

            // Hasil utama
            output.innerText = `üß† Skor NIHSS: ${data.skor} (${data.kategori})\nüì¢ ${data.saran}`;
            penanganan.innerText = `ü©∫ Tindakan: ${data.penanganan || "-"}`;

            const hasilBox = document.querySelector(".diagnosis-result");
            hasilBox.classList.remove("critical");
            hasilBox.style.background = "#f0f4ff"; // default normal
            hasilBox.style.borderLeft = "8px solid transparent";
            hasilBox.style.color = "#000";

            if (data.kategori === "Berat") {
              hasilBox.classList.add("critical");
              hasilBox.style.background = "#ffe6e6";
              hasilBox.style.borderLeft = "8px solid #e74c3c";
              hasilBox.style.color = "#b30000";
            } else if (data.kategori === "Sedang") {
              hasilBox.style.background = "#fffbe6";
              hasilBox.style.borderLeft = "8px solid #f1c40f";
              hasilBox.style.color = "#8e5e00";
            } else if (data.kategori === "Ringan") {
              hasilBox.style.background = "#f9fbe7";
              hasilBox.style.borderLeft = "8px solid #82c91e";
              hasilBox.style.color = "#466802";
            }

            // Ringkasan diagnosa
            summary.innerHTML = "";
            data.summary.forEach((item) => {
              const li = document.createElement("li");
              li.innerText = item;
              summary.appendChild(li);
            });

            // ‚úÖ Tampilkan panduan jika guidance berupa string
            if (typeof data.guidance === "string") {
              guidanceBox.innerHTML = `
                        <div class="guidance-box">
                            <i class=""fas fa-lightbulb"></i> <strong>Panduan Penanganan:</strong>
                            <p>${data.guidance}</p>
                        </div>
                    `;
            } else if (Array.isArray(data.guidance)) {
              guidanceBox.innerHTML = `
                        <div class="guidance-box">
                            <i class="fas fa-lightbulb"></i> <strong>Panduan Penanganan:</strong>
                            <ul>
                                ${data.guidance
                                  .map((item) => `<li>${item}</li>`)
                                  .join("")}
                            </ul>
                        </div>
                    `;
            } else {
              guidanceBox.innerHTML = `
                    <div class="guidance-box guidance-error">
                        ‚ö†Ô∏è Panduan tidak tersedia atau dalam format salah.
                    </div>
                `;
            }
          })
          .catch((error) => {
            output.innerText = "‚ùå Terjadi error saat diagnosa.";
            guidanceBox.innerHTML = "‚ùå Gagal memuat panduan.";
            console.error("Diagnosa error:", error);
          });
      }
    </script>

    <script>
      function showPopup(feature) {
        let title = "";
        let html = "";

        if (feature === "wajah") {
          title = "Analisis Ekspresi Wajah";
          html = `
        <div style="text-align: justify">
            <p style="text-align: center; margin-bottom: 15px;"><strong>üìç ANALISIS BIBIR</strong></p>
            <p style="line-height: 1.6;">
                <strong>Delta Y:</strong> Menghitung selisih vertikal antara posisi bibir kiri dan kanan untuk mendeteksi asimetri wajah.<br>
                <strong>Rasio X:</strong> Mengukur jarak horizontal bibir untuk memastikan posisi wajah optimal dalam frame kamera.<br>
                <strong>Sistem Penilaian:</strong>
            </p>
            <ul style="margin: 10px 0; padding-left: 20px;">
                <li>‚â§ 0,01 ‚Üí Skor 0 (Normal)</li>
                <li>0,01 - 0,03 ‚Üí Skor 1 (Ringan)</li>
                <li>> 0,03 ‚Üí Skor 2 (Signifikan)</li>
            </ul>

            <p style="text-align: center; margin: 20px 0 15px 0;"><strong>üëÅÔ∏è ANALISIS MATA</strong></p>
            <p style="line-height: 1.6;">
                <strong>Delta Openness:</strong> Mengukur perbedaan bukaan mata kiri dan kanan sebagai indikator ptosis (kelopak mata turun).<br>
                <strong>Ptosis:</strong> Kondisi medis di mana kelopak mata atas turun secara abnormal, sering terjadi pada kasus stroke.<br>
                <strong>Sistem Penilaian:</strong>
            </p>
            <ul style="margin: 10px 0; padding-left: 20px;">
                <li>‚â§ 0,01 ‚Üí Skor 0 (Normal)</li>
                <li>0,01 - 0,02 ‚Üí Skor 1 (Ringan)</li>
                <li>> 0,02 ‚Üí Skor 2 (Signifikan)</li>
            </ul>

            <p style="text-align: center; margin: 20px 0 15px 0;"><strong>üòä ANALISIS PIPI</strong></p>
            <p style="line-height: 1.6;">
                <strong>Kemiringan Wajah:</strong> Menganalisis simetri horizontal menggunakan landmark pipi kiri dan kanan untuk mendeteksi kelumpuhan fasial.<br>
                <strong>Sistem Penilaian:</strong>
            </p>
            <ul style="margin: 10px 0; padding-left: 20px;">
                <li>‚â§ 0,03 ‚Üí Skor 0 (Normal)</li>
                <li>0,03 - 0,06 ‚Üí Skor 1 (Ringan)</li>
                <li>> 0,06 ‚Üí Skor 2 (Signifikan)</li>
            </ul>

            <p style="text-align: center; margin: 20px 0 10px 0; background: #f0f8ff; padding: 10px; border-radius: 8px;">
                <strong>üìä SKOR TOTAL</strong><br>
                <span style="color: #2c5aa0;">Skor Ekspresi Wajah = Skor Bibir + Skor Mata + Skor Pipi</span>
            </p>
        </div>
        `;
        } else if (feature === "suara") {
          title = "Analisis Pola Bicara";
          html = `
        <div style="text-align: justify">
            <p style="line-height: 1.6;">Evaluasi kejelasan artikulasi dan kemampuan berbicara berdasarkan pengenalan kata dari kalimat target:</p>
            
            <div style="text-align: center; background: #f8f9fa; padding: 15px; border-radius: 10px; margin: 15px 0; border-left: 4px solid #28a745;">
                <strong style="font-size: 1.1em; color: #2c5aa0;">"Hari ini saya makan nasi"</strong>
            </div>
            
            <p style="margin: 15px 0;"><strong>üéØ Kriteria Penilaian NIHSS:</strong></p>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                <ul style="text-align: left; margin: 0; padding-left: 20px;">
                    <li style="margin: 8px 0; color: #28a745;"><strong>‚úÖ 5 kata teridentifikasi</strong> ‚Üí Suara Jelas <span style="background: #d4edda; padding: 2px 8px; border-radius: 12px; font-size: 0.9em;">(Skor 0)</span></li>
                    <li style="margin: 8px 0; color: #28a745;"><strong>‚úÖ 4 kata teridentifikasi</strong> ‚Üí Suara Hampir Jelas <span style="background: #d4edda; padding: 2px 8px; border-radius: 12px; font-size: 0.9em;">(Skor 0)</span></li>
                    <li style="margin: 8px 0; color: #ffc107;"><strong>‚ö†Ô∏è 2-3 kata teridentifikasi</strong> ‚Üí Disartria Ringan <span style="background: #fff3cd; padding: 2px 8px; border-radius: 12px; font-size: 0.9em;">(Skor 1)</span></li>
                    <li style="margin: 8px 0; color: #dc3545;"><strong>‚ùå 1 kata teridentifikasi</strong> ‚Üí Disartria Berat <span style="background: #f8d7da; padding: 2px 8px; border-radius: 12px; font-size: 0.9em;">(Skor 2)</span></li>
                    <li style="margin: 8px 0; color: #dc3545;"><strong>‚ùå 0 kata teridentifikasi</strong> ‚Üí Afasia/Mutisme <span style="background: #f8d7da; padding: 2px 8px; border-radius: 12px; font-size: 0.9em;">(Skor 2)</span></li>
                </ul>
            </div>
            
            <div style="background: #e7f3ff; padding: 12px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #007bff;">
                <p style="margin: 0; font-size: 0.95em; color: #495057;">
                    <strong>üí° Catatan:</strong> Disartria adalah gangguan berbicara akibat kelemahan otot, sedangkan afasia adalah gangguan bahasa akibat kerusakan area bahasa di otak.
                </p>
            </div>
        </div>`;
        } else if (feature === "nihss") {
          title = "Sistem Penilaian NIHSS";
          html = `
        <div style="text-align: justify">
            <p style="line-height: 1.6; margin-bottom: 20px;">
                <strong>National Institutes of Health Stroke Scale (NIHSS)</strong> adalah instrumen standar untuk mengevaluasi tingkat keparahan stroke secara objektif.
            </p>
            
            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin: 15px 0;">
                <p style="margin: 0 0 10px 0;"><strong>üìä Komponen Penilaian:</strong></p>
                <ul style="text-align: left; margin: 0; padding-left: 20px;">
                    <li style="margin: 5px 0;"><strong>Skor Ekspresi Wajah:</strong> 0‚Äì6 poin</li>
                    <li style="margin: 5px 0;"><strong>Skor Pola Bicara:</strong> 0‚Äì2 poin</li>
                </ul>
            </div>
            
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; margin: 20px 0;">
                <p style="margin: 0 0 15px 0; text-align: center;"><strong>üè• INTERPRETASI KLINIS</strong></p>
                <div style="display: grid; gap: 10px;">
                    <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px;">
                        <strong>Skor 0:</strong> <span style="color: #90EE90;">Fungsi Normal</span> - Tidak ada tanda neurologis
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px;">
                        <strong>Skor 1-2:</strong> <span style="color: #FFE135;">Stroke Ringan</span> - Defisit neurologis minimal
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px;">
                        <strong>Skor 3-4:</strong> <span style="color: #FFA500;">Stroke Sedang</span> - Defisit neurologis moderat
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px;">
                        <strong>Skor ‚â•5:</strong> <span style="color: #FF6B6B;">Stroke Berat</span> - Defisit neurologis signifikan
                    </div>
                </div>
            </div>
            
            <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107; margin-top: 15px;">
                <p style="margin: 0; font-size: 0.95em; color: #856404;">
                    <strong>‚ö†Ô∏è Disclaimer:</strong> Aplikasi ini hanya untuk skrining awal. Diagnosis dan penanganan stroke harus dilakukan oleh tenaga medis profesional di fasilitas kesehatan yang tepat.
                </p>
            </div>
        </div>`;
        }

        Swal.fire({
          title: title,
          html: html,
          icon: "info",
          confirmButtonText: "Tutup",
          width: 700,
          customClass: {
            popup: "swal-custom-popup",
            title: "swal-custom-title",
            content: "swal-custom-content",
          },
        });
      }
    </script>
    <script>
      document.querySelectorAll(".accordion-header").forEach((header) => {
        header.addEventListener("click", () => {
          const item = header.parentElement;
          item.classList.toggle("active");
          header.classList.toggle("active");
        });
      });
    </script>
  </body>
</html>